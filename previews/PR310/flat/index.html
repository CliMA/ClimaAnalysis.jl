<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>FlatVar · ClimaAnalysis.jl</title><meta name="title" content="FlatVar · ClimaAnalysis.jl"/><meta property="og:title" content="FlatVar · ClimaAnalysis.jl"/><meta property="twitter:title" content="FlatVar · ClimaAnalysis.jl"/><meta name="description" content="Documentation for ClimaAnalysis.jl."/><meta property="og:description" content="Documentation for ClimaAnalysis.jl."/><meta property="twitter:description" content="Documentation for ClimaAnalysis.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaAnalysis.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaAnalysis.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../var/">OutputVars</a></li><li><a class="tocitem" href="../visualize/">Visualizing OutputVars</a></li><li><a class="tocitem" href="../read_files/">Reading NetCDF files</a></li><li><a class="tocitem" href="../rmse_var/">RMSEVariables</a></li><li><a class="tocitem" href="../visualize_rmse_var/">Visualizing RMSEVariables</a></li><li class="is-active"><a class="tocitem" href>FlatVar</a><ul class="internal"><li><a class="tocitem" href="#Flatten"><span>Flatten</span></a></li><li><a class="tocitem" href="#Unflatten"><span>Unflatten</span></a></li></ul></li><li><a class="tocitem" href="../api/">APIs</a></li><li><a class="tocitem" href="../howdoi/">How do I?</a></li><li><a class="tocitem" href="../developer/">Developer Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>FlatVar</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>FlatVar</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAnalysis.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAnalysis.jl/blob/main/docs/src/flat.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="FlatVar"><a class="docs-heading-anchor" href="#FlatVar"><code>FlatVar</code></a><a id="FlatVar-1"></a><a class="docs-heading-anchor-permalink" href="#FlatVar" title="Permalink"></a></h1><p>To help with data preparation and feeding data from <code>OutputVar</code>s into other pipelines, ClimaAnalysis provides two functions <a href="../api/#ClimaAnalysis.Var.flatten"><code>flatten</code></a> to flatten an <code>OutputVar</code> into a <code>FlatVar</code> and <a href="../api/#ClimaAnalysis.Var.unflatten"><code>unflatten</code></a> to unflatten a <code>FlatVar</code> into an <code>OutputVar</code>. A <code>FlatVar</code> consists of <code>data</code> which is a one-dimensional vector of the <code>OutputVar</code>&#39;s data and <code>metadata</code> which contain all the necessary information to reconstruct the original <code>OutputVar</code>.</p><p>The problems that <code>FlatVar</code> aim to solve are</p><ol><li>Flattening can be error prone if one does not keep track of the ordering of the dimensions,</li><li>Flattening a one-dimensional vector loses important information, such as what quantity is represented by the <code>OutputVar</code> and the ordering of the dimensions.</li></ol><h2 id="Flatten"><a class="docs-heading-anchor" href="#Flatten">Flatten</a><a id="Flatten-1"></a><a class="docs-heading-anchor-permalink" href="#Flatten" title="Permalink"></a></h2><p>To solve the first problem, ClimaAnalysis enforces the ordering of the dimensions when flattening to be <code>(&quot;longitude&quot;, &quot;latitude&quot;, &quot;pressure&quot;, &quot;altitude&quot;, &quot;time&quot;)</code> and omits the dimensions that do not exist in the <code>OutputVar</code>.</p><p>The example below demonstrates how the order of the dimensions of a <code>OutputVar</code> does not matter when flattening the data. The order of dimensions of <code>flat_var</code> is <code>time</code>, <code>lon</code>, and <code>lat</code>, and the order of dimensions of <code>permuted_var</code> is <code>lon</code>, <code>lat</code>, and <code>time</code>. When both <code>OutputVar</code>s are flattened, the flattened data of both <code>OutputVar</code>s are the same. As such, using <code>flatten</code> removes the need to keep track of the order of the dimensions of a <code>OutputVar</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; var</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr32"><span class="sgr1">Attributes:</span></span>
  short_name =&gt; <span class="sgr96">pr</span>
<span class="sgr32"><span class="sgr1">Dimension attributes:</span></span>
<span class="sgr92">  time:</span>
    units =&gt; <span class="sgr96">s</span>
<span class="sgr92">  lon:</span>
    units =&gt; <span class="sgr96">degrees_east</span>
<span class="sgr92">  lat:</span>
    units =&gt; <span class="sgr96">degrees_north</span>
<span class="sgr32"><span class="sgr1">Data defined over:</span></span>
<span class="sgr92">  time</span> with <span class="sgr96">3 </span>elements (<span class="sgr96">0.0</span> to <span class="sgr96">5.0</span>)
<span class="sgr92">  lon </span> with <span class="sgr96">5 </span>elements (<span class="sgr96">-60.0</span> to <span class="sgr96">60.0</span>)
<span class="sgr92">  lat </span> with <span class="sgr96">4 </span>elements (<span class="sgr96">-90.0</span> to <span class="sgr96">90.0</span>)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flat_var = ClimaAnalysis.flatten(var);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; permuted_var = permutedims(var, (&quot;longitude&quot;, &quot;latitude&quot;, &quot;time&quot;));</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flat_permuted_var = ClimaAnalysis.flatten(permuted_var);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; isequal(flat_permuted_var.data, flat_var.data)</code><code class="nohighlight hljs ansi" style="display:block;">true</code></pre><p>The data can be extracted by <code>flat_var.data</code> and the metadata can be extracted by <code>flatvar.metadata</code>. More information about the metadata will discussed in the section below.</p><h3 id="Ignore-NaNs"><a class="docs-heading-anchor" href="#Ignore-NaNs">Ignore NaNs</a><a id="Ignore-NaNs-1"></a><a class="docs-heading-anchor-permalink" href="#Ignore-NaNs" title="Permalink"></a></h3><p>Furthermore, if <code>ignore_nan = true</code>, then <code>NaNs</code> are excluded when flattening the data.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; count(isnan, nan_var.data) # nan_var is the same as var, but contains three NaNs</code><code class="nohighlight hljs ansi" style="display:block;">3</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flat_nan_var = ClimaAnalysis.flatten(nan_var, ignore_nan = true); # default is true</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; length(flat_nan_var.data)</code><code class="nohighlight hljs ansi" style="display:block;">57</code></pre><h3 id="Masking"><a class="docs-heading-anchor" href="#Masking">Masking</a><a id="Masking-1"></a><a class="docs-heading-anchor-permalink" href="#Masking" title="Permalink"></a></h3><p>In addition to ignoring <code>NaN</code>s, you can also pass in a <a href="../api/#ClimaAnalysis.Var.LonLatMask"><code>ClimaAnalysis.Var.LonLatMask</code></a> for the keyword argument <code>mask_var</code>. This will do a mask-aware flatten on the `OutputVar.</p><div class="admonition is-info" id="Zeros-and-ones-45e19698465a5f29"><header class="admonition-header">Zeros and ones<a class="admonition-anchor" href="#Zeros-and-ones-45e19698465a5f29" title="Permalink"></a></header><div class="admonition-body"><p><code>ClimaAnalysis</code> drop any values whose coordinates correspond to zero in the mask.</p></div></div><pre><code class="language-julia hljs"># Mask map coordinates on the ocean to NaN and coordinates on the land to 1.0
ocean_mask = ClimaAnalysis.generate_ocean_mask(NaN, 1.0; threshold = 0.5)
flat_masked_var = ClimaAnalysis.flatten(var, mask = ocean_mask)
# All values on the ocean are not considered when flattening
length(flat_nan_var.data)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">57</code></pre><h2 id="Unflatten"><a class="docs-heading-anchor" href="#Unflatten">Unflatten</a><a id="Unflatten-1"></a><a class="docs-heading-anchor-permalink" href="#Unflatten" title="Permalink"></a></h2><p>To solve the second problem, there is the <code>metadata</code> field in <code>FlatVar</code> that stores the necessary information to fully reconstruct the <code>OutputVar</code>. With <code>unflatten</code>, one can call <code>unflatten</code> on both <code>FlatVar</code> or on <code>metadata</code> and <code>data</code> to reconstruct the <code>OutputVar</code>. This decoupling of <code>metadata</code> and <code>data</code> also means that one needs to be careful that the correct <code>metadata</code> and <code>data</code> are being used to reconstruct the <code>Outputvar</code>.</p><p>See the example below of unflattening <code>flat_var</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; unflatten_var = ClimaAnalysis.unflatten(flat_var)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr32"><span class="sgr1">Attributes:</span></span>
  short_name =&gt; <span class="sgr96">pr</span>
<span class="sgr32"><span class="sgr1">Dimension attributes:</span></span>
<span class="sgr92">  time:</span>
    units =&gt; <span class="sgr96">s</span>
<span class="sgr92">  lon:</span>
    units =&gt; <span class="sgr96">degrees_east</span>
<span class="sgr92">  lat:</span>
    units =&gt; <span class="sgr96">degrees_north</span>
<span class="sgr32"><span class="sgr1">Data defined over:</span></span>
<span class="sgr92">  time</span> with <span class="sgr96">3 </span>elements (<span class="sgr96">0.0</span> to <span class="sgr96">5.0</span>)
<span class="sgr92">  lon </span> with <span class="sgr96">5 </span>elements (<span class="sgr96">-60.0</span> to <span class="sgr96">60.0</span>)
<span class="sgr92">  lat </span> with <span class="sgr96">4 </span>elements (<span class="sgr96">-90.0</span> to <span class="sgr96">90.0</span>)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; isequal(unflatten_var.data, var.data)</code><code class="nohighlight hljs ansi" style="display:block;">true</code></pre><p>One can also unflatten using the metadata and data of <code>flat_var</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; unflatten_var = ClimaAnalysis.unflatten(flat_var.metadata, flat_var.data)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr32"><span class="sgr1">Attributes:</span></span>
  short_name =&gt; <span class="sgr96">pr</span>
<span class="sgr32"><span class="sgr1">Dimension attributes:</span></span>
<span class="sgr92">  time:</span>
    units =&gt; <span class="sgr96">s</span>
<span class="sgr92">  lon:</span>
    units =&gt; <span class="sgr96">degrees_east</span>
<span class="sgr92">  lat:</span>
    units =&gt; <span class="sgr96">degrees_north</span>
<span class="sgr32"><span class="sgr1">Data defined over:</span></span>
<span class="sgr92">  time</span> with <span class="sgr96">3 </span>elements (<span class="sgr96">0.0</span> to <span class="sgr96">5.0</span>)
<span class="sgr92">  lon </span> with <span class="sgr96">5 </span>elements (<span class="sgr96">-60.0</span> to <span class="sgr96">60.0</span>)
<span class="sgr92">  lat </span> with <span class="sgr96">4 </span>elements (<span class="sgr96">-90.0</span> to <span class="sgr96">90.0</span>)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; isequal(unflatten_var.data, var.data)</code><code class="nohighlight hljs ansi" style="display:block;">true</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../visualize_rmse_var/">« Visualizing RMSEVariables</a><a class="docs-footer-nextpage" href="../api/">APIs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 11 August 2025 15:09">Monday 11 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
